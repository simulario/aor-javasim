<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="prettyprint.xsl"?>
<SimulationScenario scenarioName="PacMan" version="0.9" xmlns="http://aor-simulation.org"
    xmlns:aors="http://aor-simulation.org" xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://aor-simulation.org ../../../AORSL/AORSL_0-9.xsd">
    <documentation>
        <dc:creator>Mircea Diaconescu</dc:creator>
        <dc:created>23 Juni 2011</dc:created>
        <dc:description> Classic Pac Man arcade game. </dc:description>
    </documentation>
    <SimulationParameters simulationSteps="100000" stepTimeDelay="50" />
    <SimulationModel modelName="PacMan" modelTitle="Pac Man Classic Arcade Game">
        <SpaceModel geometry="Euclidean">
            <TwoDimensionalGrid xMax="20" yMax="11">
                <!-- determine the cell role (0 = free to walk into cell, 1 = cell has wall role) -->
                <GridCellProperty name="cellRole" type="Integer" />
            </TwoDimensionalGrid>
        </SpaceModel>
        <DataTypes>
            <Enumeration name="Direction">
                <EnumerationLiteral>NONE</EnumerationLiteral>
                <EnumerationLiteral>SOUTH</EnumerationLiteral>
                <EnumerationLiteral>NORTH</EnumerationLiteral>
                <EnumerationLiteral>EAST</EnumerationLiteral>
                <EnumerationLiteral>WEST</EnumerationLiteral>
            </Enumeration>
        </DataTypes>
        <Globals>
            <GlobalVariable dataType="Integer" initialValue="20" name="MapWidth" />
            <GlobalVariable dataType="Integer" initialValue="11" name="MapHeight" />
            <GlobalVariable dataType="Integer" initialValue="105" name="remainingPillFoodNumber" />
            <GlobalFunction name="isWallOnCoordinates" resultType="boolean">
                <Parameter name="x" type="int" />
                <Parameter name="y" type="int" />
                <Body language="JavaScript">
                    <![CDATA[
                        var map = [ 
                            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
                            [1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1],
                            [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                            [1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1],
                            [1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1],
                            [1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1],
                            [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                            [1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1],
                            [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
                        ];
                        
                        var rows = map.length;
                        return map[rows - y][x-1] === 1;
                    ]]>
                </Body>
            </GlobalFunction>
        </Globals>
        <EntityTypes>
            <!-- The Event that will let the environment knows that the PacMan must move -->
            <ActionEventType name="Move">
                <!-- The moving X increment/decrement -->
                <Attribute name="x" type="Integer" />
                <!-- The moving Y increment/decrement -->
                <Attribute name="y" type="Integer" />
                <!-- The moving direction - used for some logic purposes -->
                <EnumerationProperty name="direction" type="Direction" />
                <!-- Reference to the object that will move -->
                <ReferenceProperty name="objectReference" type="PacMan" />
            </ActionEventType>
            <!-- The type that represents the Pills Food that are eaten by the PacMan -->
            <PhysicalObjectType name="PillFood" />
            <!-- The Lord of the simulation...PacMan -->
            <PhysicalAgentType name="PacMan">
                <!-- flag used to determine if the PacMan has the mouth open or closed -->
                <Attribute initialValue="false" name="mouthOpen" type="Boolean" />
                <!-- the current moving direction -->
                <EnumerationProperty name="movingDirection" type="Direction" />
                <!-- Action rule invoked when the user decides to move to east -->
                <ActionRule agentVariable="pacman" name="MoveEast_ActionRule">
                    <IF language="Java JavaScript">
                        <![CDATA[
                            !__Global.isWallOnCoordinates(this.pacman.getX() + 1, this.pacman.getY())
                        ]]>
                    </IF>
                    <THEN>
                        <UPDATE-AGT>
                            <Slot property="movingDirection" value="__Direction.EAST" />
                        </UPDATE-AGT>
                        <SCHEDULE-EVT>
                            <ActionEventExpr actionEventType="Move">
                                <Slot property="objectReference">
                                    <ValueExpr language="Java JavaScript">
                                        <![CDATA[
                                            this.pacman
                                        ]]>
                                    </ValueExpr>
                                </Slot>
                                <Slot property="direction" value="__Direction.EAST" />
                                <Slot property="x" value="1" />
                                <Slot property="y" value="0" />
                            </ActionEventExpr>
                        </SCHEDULE-EVT>
                    </THEN>
                </ActionRule>
                <!-- Action rule invoked when the user decides to move to west -->
                <ActionRule agentVariable="pacman" name="MoveWest_ActionRule">
                    <IF language="Java JavaScript">
                        <![CDATA[
                           !__Global.isWallOnCoordinates(this.pacman.getX() - 1, this.pacman.getY())
                        ]]>
                    </IF>
                    <THEN>
                        <UPDATE-AGT>
                            <Slot property="movingDirection" value="__Direction.WEST" />
                        </UPDATE-AGT>
                        <SCHEDULE-EVT>
                            <ActionEventExpr actionEventType="Move">
                                <Slot property="objectReference">
                                    <ValueExpr language="Java JavaScript">
                                        <![CDATA[
                                            this.pacman
                                        ]]>
                                    </ValueExpr>
                                </Slot>
                                <Slot property="direction" value="__Direction.WEST" />
                                <Slot property="x" value="-1" />
                                <Slot property="y" value="0" />
                            </ActionEventExpr>
                        </SCHEDULE-EVT>
                    </THEN>
                </ActionRule>
                <!-- Action rule invoked when the user decides to move to North -->
                <ActionRule agentVariable="pacman" name="MoveNorth_ActionRule">
                    <IF language="Java JavaScript">
                    <![CDATA[
                        !__Global.isWallOnCoordinates(this.pacman.getX(), this.pacman.getY() + 1)
                    ]]>
                    </IF>
                    <THEN>
                        <UPDATE-AGT>
                            <Slot property="movingDirection" value="__Direction.NORTH" />
                        </UPDATE-AGT>
                        <SCHEDULE-EVT>
                            <ActionEventExpr actionEventType="Move">
                                <Slot property="objectReference">
                                    <ValueExpr language="Java JavaScript">
                                         <![CDATA[
                                            this.pacman
                                         ]]>
                                    </ValueExpr>
                                </Slot>
                                <Slot property="direction" value="__Direction.NORTH" />
                                <Slot property="x" value="0" />
                                <Slot property="y" value="1" />
                            </ActionEventExpr>
                        </SCHEDULE-EVT>
                    </THEN>
                </ActionRule>
                <!-- Action rule invoked when the user decides to move to South -->
                <ActionRule agentVariable="pacman" name="MoveSouth_ActionRule">
                    <IF language="Java JavaScript">
                    <![CDATA[
                        !__Global.isWallOnCoordinates(this.pacman.getX(), this.pacman.getY() - 1)
                    ]]>
                    </IF>
                    <THEN>
                        <UPDATE-AGT>
                            <Slot property="movingDirection" value="__Direction.SOUTH" />
                        </UPDATE-AGT>
                        <SCHEDULE-EVT>
                            <ActionEventExpr actionEventType="Move">
                                <Slot property="objectReference">
                                    <ValueExpr language="Java JavaScript">
                                         <![CDATA[
                                            this.pacman
                                         ]]>
                                    </ValueExpr>
                                </Slot>
                                <Slot property="direction" value="__Direction.SOUTH" />
                                <Slot property="x" value="0" />
                                <Slot property="y" value="-1" />
                            </ActionEventExpr>
                        </SCHEDULE-EVT>
                    </THEN>
                </ActionRule>
            </PhysicalAgentType>
            <!-- The type that represents the PacMan's enemy GhostBlinky -->
            <PhysicalAgentType name="GhostBlinky">
                <!-- the current moving direction -->
                <EnumerationProperty name="movingDirection" type="__Direction" />
                <Function name="getXIncrement" resultType="int">
                    <Body language="JavaScript">
                        <![CDATA[
                            return 1;
                        ]]>
                    </Body>
                </Function>
                <Function name="getYIncrement" resultType="int">
                    <Body language="JavaScript">
                        <![CDATA[
                            return 0;
                        ]]>
                    </Body>
                </Function>
            </PhysicalAgentType>
            
            <!-- The type that represents the PacMan's enemy GhostBlinky -->
            <PhysicalAgentType name="GhostInky">
                <!-- the current moving direction -->
                <EnumerationProperty name="movingDirection" type="__Direction" />
                <Function name="getXIncrement" resultType="int">
                    <Body language="JavaScript">
                        <![CDATA[
                            return 1;
                        ]]>
                    </Body>
                </Function>
                <Function name="getYIncrement" resultType="int">
                    <Body language="JavaScript">
                        <![CDATA[
                            return 0;
                        ]]>
                    </Body>
                </Function>
            </PhysicalAgentType>
        </EntityTypes>
        <!-- This rule is used to allow close/open of the PacMan mouth -->
        <EnvironmentRules>
            <EnvironmentRule name="OnEachStepRule">
                <ON-EACH-SIMULATION-STEP />
                <FOR-ObjectVariable objectIdRef="1" objectType="PacMan" variable="pacMan" />
                <IF language="JavaScript">
                    <![CDATA[
                        __Simulator.getCurrentSimulationStep() % 5 === 0
                    ]]>
                </IF>
                <THEN>
                    <UPDATE-ENV>
                        <UpdateObject objectVariable="pacMan">
                            <Slot property="mouthOpen">
                                <ValueExpr language="Java JavaScript">
                                    <![CDATA[
                                        !this.pacMan.isMouthOpen()
                                    ]]>
                                </ValueExpr>
                            </Slot>
                        </UpdateObject>
                    </UPDATE-ENV>
                </THEN>
            </EnvironmentRule>
            <!-- The PacMan finds PillFood in the cell and will eat it -->
            <EnvironmentRule name="PacManEatPillFood">
                <ON-EACH-SIMULATION-STEP />
                <FOR-ObjectVariable objectIdRef="1" objectType="PacMan" variable="pacman" />
                <FOR-ObjectVariable objectType="PillFood" variable="pillFood">
                    <SelectionCondition language="Java JavaScript">
                        <![CDATA[
                            (this.pacman.getY()-1) * __Global.getMapWidth() + this.pacman.getX() === this.pillFood.getId()
                        ]]>
                    </SelectionCondition>
                </FOR-ObjectVariable>
                <IF language="Java JavaScript">
                    <![CDATA[
                        this.pillFood !== null
                    ]]>
                </IF>
                <THEN>
                    <UPDATE-ENV>
                        <DestroyObject objectType="PillFood">
                            <ObjectRef language="Java JavaScript">
                                <![CDATA[
                                    this.pillFood
                                ]]>
                            </ObjectRef>
                        </DestroyObject>
                        <IncrementGlobalVariable name="remainingPillFoodNumber" value="-1" />
                    </UPDATE-ENV>
                </THEN>
            </EnvironmentRule>
            <!-- Move one object/agent with the given increments/decrements -->
            <EnvironmentRule name="MoveObject_Rule">
                <WHEN eventType="Move" eventVariable="moveEvent" />
                <FOR-ObjectVariable objectType="PacMan" variable="objectToMove">
                    <ObjectRef language="Java JavaScript">
                        <![CDATA[
                            this.moveEvent.getObjectReference()
                        ]]>
                    </ObjectRef>
                </FOR-ObjectVariable>
                <FOR-DataVariable dataType="Integer" variable="newX">
                    <ValueExpr language="Java JavaScript">
                        <![CDATA[
                            this.objectToMove.getX() + this.moveEvent.getX()
                        ]]>
                    </ValueExpr>
                </FOR-DataVariable>
                <FOR-DataVariable dataType="Integer" variable="newY">
                    <ValueExpr language="Java JavaScript">
                        <![CDATA[
                            this.objectToMove.getY() + this.moveEvent.getY()
                        ]]>
                    </ValueExpr>
                </FOR-DataVariable>
                <DO>
                    <UPDATE-ENV>
                        <UpdateObject objectVariable="objectToMove">
                            <Slot property="x">
                                <ValueExpr language="Java JavaScript">
                                    <![CDATA[
                                        this.newX
                                    ]]>
                                </ValueExpr>
                            </Slot>
                            <Slot property="y">
                                <ValueExpr language="Java JavaScript">
                                    <![CDATA[
                                        this.newY
                                    ]]>
                                </ValueExpr>
                            </Slot>
                        </UpdateObject>
                    </UPDATE-ENV>
                </DO>
            </EnvironmentRule>
            <!-- Decide next movement of the Ghost Blinky (red ghost) -->
            <EnvironmentRule name="MoveGhostsBlinky_Rule">
                <ON-EACH-SIMULATION-STEP />
                <FOR-ObjectVariable objectIdRef="10000" objectType="GhostBlinky" variable="blinky" />
                <FOR-DataVariable dataType="Integer" variable="xIncrement">
                    <ValueExpr language="Java JavaScript">
                        <![CDATA[
                            this.blinky.getXIncrement()
                        ]]>
                    </ValueExpr>
                </FOR-DataVariable>
                <FOR-DataVariable dataType="Integer" variable="yIncrement">
                    <ValueExpr language="Java JavaScript">
                        <![CDATA[
                            this.blinky.getYIncrement()
                        ]]>
                    </ValueExpr>
                </FOR-DataVariable>
                <IF language="JavaScript">
                    <![CDATA[
                        __Simulator.getCurrentSimulationStep() % 7 === 0
                    ]]>
                </IF>
                <THEN>
                    <UPDATE-ENV>
                        <UpdateObject objectVariable="blinky">
                            <Slot property="x">
                                <ValueExpr language="Java JavaScript">
                                    <![CDATA[
                                        this.blinky.getX() % 19 + this.xIncrement 
                                    ]]>
                                </ValueExpr>
                            </Slot>
                            <Slot property="y">
                                <ValueExpr language="Java JavaScript">
                                    <![CDATA[
                                         this.blinky.getY() + this.yIncrement
                                    ]]>
                                </ValueExpr>
                            </Slot>
                            <Slot property="movingDirection">
                                <ValueExpr language="JavaScript">
                                    <![CDATA[
                                        (this.xIncrement === 1 ? __Direction.EAST : 
                                            (this.xIncrement === -1 ? __Direction.WEST : 
                                                (this.yIncrement === 1 ? __Direction.NORTH : 
                                                    (this.yIncrement === -1 ? __Direction.SOUTH : __Direction.NONE))))
                                    ]]>
                                </ValueExpr>
                            </Slot>
                        </UpdateObject>
                    </UPDATE-ENV>
                </THEN>
            </EnvironmentRule>
            
            <!-- Decide next movement of the Ghost Inky (turquoise ghost) -->
            <EnvironmentRule name="MoveGhostsInky_Rule">
                <ON-EACH-SIMULATION-STEP />
                <FOR-ObjectVariable objectIdRef="11000" objectType="GhostInky" variable="inky" />
                <FOR-DataVariable dataType="Integer" variable="xIncrement">
                    <ValueExpr language="Java JavaScript">
                        <![CDATA[
                            this.inky.getXIncrement()
                        ]]>
                    </ValueExpr>
                </FOR-DataVariable>
                <FOR-DataVariable dataType="Integer" variable="yIncrement">
                    <ValueExpr language="Java JavaScript">
                        <![CDATA[
                            this.inky.getYIncrement()
                        ]]>
                    </ValueExpr>
                </FOR-DataVariable>
                <IF language="JavaScript">
                    <![CDATA[
                        __Simulator.getCurrentSimulationStep() % 10 === 0
                    ]]>
                </IF>
                <THEN>
                    <UPDATE-ENV>
                        <UpdateObject objectVariable="inky">
                            <Slot property="x">
                                <ValueExpr language="Java JavaScript">
                                    <![CDATA[
                                        this.inky.getX() % 19 + this.xIncrement 
                                    ]]>
                                </ValueExpr>
                            </Slot>
                            <Slot property="y">
                                <ValueExpr language="Java JavaScript">
                                    <![CDATA[
                                         this.inky.getY() + this.yIncrement
                                    ]]>
                                </ValueExpr>
                            </Slot>
                            <Slot property="movingDirection">
                                <ValueExpr language="JavaScript">
                                    <![CDATA[
                                        (this.xIncrement === 1 ? __Direction.EAST : 
                                            (this.xIncrement === -1 ? __Direction.WEST : 
                                                (this.yIncrement === 1 ? __Direction.NORTH : 
                                                    (this.yIncrement === -1 ? __Direction.SOUTH : __Direction.NONE))))
                                    ]]>
                                </ValueExpr>
                            </Slot>
                        </UpdateObject>
                    </UPDATE-ENV>
                </THEN>
            </EnvironmentRule>
            <!-- CHeck if the PacMan is killed by the ghosts -->
            <EnvironmentRule name="PacManDies_Rule">
                <ON-EACH-SIMULATION-STEP/>
                <FOR-ObjectVariable variable="pacman" objectType="PacMan" objectIdRef="1"/>
                <FOR-ObjectVariable variable="ghostBlinky" objectType="GhostBlinky" objectIdRef="10000"/>
                <FOR-ObjectVariable variable="ghostInky" objectType="GhostInky" objectIdRef="11000"/>
                <IF language="Java JavaScript">
                    <![CDATA[
                        (this.pacman.getX() === this.ghostBlinky.getX() && this.pacman.getY() === this.ghostBlinky.getY())
                        || (this.pacman.getX() === this.ghostInky.getX() && this.pacman.getY() === this.ghostInky.getY())
                    ]]>
                </IF>
                <THEN>
                    <SCHEDULE-EVT>
                        <CausedEventExpr eventType="StopSimulation"/>
                    </SCHEDULE-EVT>
                </THEN>
            </EnvironmentRule>
        </EnvironmentRules>
    </SimulationModel>
    <InitialState>
        <GridCells>
            <!-- top wall(s) -->
            <GridCellSet endX="20" endY="11" startX="1" startY="11">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCellSet endX="6" endY="10" startX="6" startY="9">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCellSet endX="15" endY="10" startX="15" startY="9">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- bottom wall(s) -->
            <GridCellSet endX="20" endY="1" startX="1" startY="1">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCellSet endX="6" endY="3" startX="6" startY="2">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCellSet endX="15" endY="3" startX="15" startY="2">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- left wall -->
            <GridCellSet endX="1" endY="11" startX="1" startY="1">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- right wall -->
            <GridCellSet endX="20" endY="11" startX="20" startY="1">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- center wall(s) -->
            <GridCellSet endX="9" endY="7" startX="8" startY="7">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCellSet endX="13" endY="7" startX="12" startY="7">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCellSet endX="13" endY="5" startX="8" startY="5">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCell x="8" y="6">
                <Slot property="cellRole" value="1" />
            </GridCell>
            <GridCell x="13" y="6">
                <Slot property="cellRole" value="1" />
            </GridCell>
            <!-- center-down Line-Wall -->
            <GridCellSet endX="13" endY="3" startX="8" startY="3">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- center-top Line-Wall -->
            <GridCellSet endX="13" endY="9" startX="8" startY="9">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- left-down 2-Piece-Wall -->
            <GridCellSet endX="6" endY="5" startX="5" startY="5">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- left-top 2-Piece-Wall -->
            <GridCellSet endX="6" endY="7" startX="5" startY="7">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- right-down 2-Piece-Wall -->
            <GridCellSet endX="16" endY="5" startX="15" startY="5">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- right-top 2-Piece-Wall -->
            <GridCellSet endX="16" endY="7" startX="15" startY="7">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <!-- left-down L-Wall -->
            <GridCellSet endX="3" endY="5" startX="3" startY="3">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCell x="4" y="3">
                <Slot property="cellRole" value="1" />
            </GridCell>
            <!-- left-top L-Wall -->
            <GridCellSet endX="3" endY="9" startX="3" startY="7">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCell x="4" y="9">
                <Slot property="cellRole" value="1" />
            </GridCell>
            <!-- right-down L-Wall -->
            <GridCellSet endX="18" endY="5" startX="18" startY="3">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCell x="17" y="3">
                <Slot property="cellRole" value="1" />
            </GridCell>
            <!-- right-top L-Wall -->
            <GridCellSet endX="18" endY="9" startX="18" startY="7">
                <Slot property="cellRole" value="1" />
            </GridCellSet>
            <GridCell x="17" y="9">
                <Slot property="cellRole" value="1" />
            </GridCell>
        </GridCells>
        <PhysicalAgent id="1" name="PacMan" type="PacMan" x="10" y="2" />
        <PhysicalAgent id="10000" name="Blinky" type="GhostBlinky" x="9" y="6" />
        <PhysicalAgent id="11000" name="Inky" type="GhostInky" x="12" y="6" />
        <!-- First line of Food-Pills-->
        <PhysicalObjects objectVariable="pillFood" rangeEndID="25" rangeStartID="22" type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                   <![CDATA[
                        pillFood.getId() % 20
                   ]]>
               </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <PhysicalObjects objectVariable="pillFood" rangeEndID="29" rangeStartID="27" type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                         parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <PhysicalObjects objectVariable="pillFood" rangeEndID="34" rangeStartID="31" type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                         parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <PhysicalObjects objectVariable="pillFood" rangeEndID="39" rangeStartID="36" type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                         parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <!-- Second line of Food-Pills-->
        <PhysicalObject id="42" objectVariable="pillFood" type="PillFood" x="2" y="3" />
        <PhysicalObject id="45" objectVariable="pillFood" type="PillFood" x="5" y="3" />
        <PhysicalObject id="47" objectVariable="pillFood" type="PillFood" x="7" y="3" />
        <PhysicalObject id="54" objectVariable="pillFood" type="PillFood" x="14" y="3" />
        <PhysicalObject id="56" objectVariable="pillFood" type="PillFood" x="16" y="3" />
        <PhysicalObject id="59" objectVariable="pillFood" type="PillFood" x="19" y="3" />
        <!-- Third line of Food-Pills-->
        <PhysicalObject id="62" objectVariable="pillFood" type="PillFood" x="2" y="4" />
        <PhysicalObject id="79" objectVariable="pillFood" type="PillFood" x="19" y="4" />
        <PhysicalObjects objectVariable="pillFood" rangeEndID="77" rangeStartID="64" type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <!-- 4th line of Food-Pills-->
        <PhysicalObject id="82" objectVariable="pillFood" type="PillFood" x="2" y="5" />
        <PhysicalObject id="84" objectVariable="pillFood" type="PillFood" x="4" y="5" />
        <PhysicalObject id="87" objectVariable="pillFood" type="PillFood" x="7" y="5" />
        <PhysicalObject id="94" objectVariable="pillFood" type="PillFood" x="14" y="5" />
        <PhysicalObject id="97" objectVariable="pillFood" type="PillFood" x="17" y="5" />
        <PhysicalObject id="99" objectVariable="pillFood" type="PillFood" x="19" y="5" />
        <!-- 5th line of Food-Pills-->
        <PhysicalObjects objectVariable="pillFood" rangeEndID="107" rangeStartID="102"
            type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <PhysicalObjects objectVariable="pillFood" rangeEndID="119" rangeStartID="114"
            type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <!-- 6th line of Food-Pills-->
        <PhysicalObject id="122" objectVariable="pillFood" type="PillFood" x="2" y="7" />
        <PhysicalObject id="124" objectVariable="pillFood" type="PillFood" x="4" y="7" />
        <PhysicalObject id="127" objectVariable="pillFood" type="PillFood" x="7" y="7" />
        <PhysicalObject id="134" objectVariable="pillFood" type="PillFood" x="14" y="7" />
        <PhysicalObject id="137" objectVariable="pillFood" type="PillFood" x="17" y="7" />
        <PhysicalObject id="139" objectVariable="pillFood" type="PillFood" x="19" y="7" />
        <!-- 7th line of Food-Pills-->
        <PhysicalObject id="142" objectVariable="pillFood" type="PillFood" x="2" y="8" />
        <PhysicalObject id="159" objectVariable="pillFood" type="PillFood" x="19" y="8" />
        <PhysicalObjects objectVariable="pillFood" rangeEndID="157" rangeStartID="144"
            type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <!-- 8th line of Food-Pills-->
        <PhysicalObject id="162" objectVariable="pillFood" type="PillFood" x="2" y="9" />
        <PhysicalObject id="165" objectVariable="pillFood" type="PillFood" x="5" y="9" />
        <PhysicalObject id="167" objectVariable="pillFood" type="PillFood" x="7" y="9" />
        <PhysicalObject id="174" objectVariable="pillFood" type="PillFood" x="14" y="9" />
        <PhysicalObject id="176" objectVariable="pillFood" type="PillFood" x="16" y="9" />
        <PhysicalObject id="179" objectVariable="pillFood" type="PillFood" x="19" y="9" />
        <!-- 9th line of Food-Pills-->
        <PhysicalObjects objectVariable="pillFood" rangeEndID="185" rangeStartID="182"
            type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <PhysicalObjects objectVariable="pillFood" rangeEndID="194" rangeStartID="187"
            type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                         parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
        <PhysicalObjects objectVariable="pillFood" rangeEndID="199" rangeStartID="196"
            type="PillFood">
            <Slot property="x">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                        pillFood.getId() % 20
                   ]]>
                </ValueExpr>
            </Slot>
            <Slot property="y">
                <ValueExpr language="Java JavaScript">
                    <![CDATA[
                         parseInt(pillFood.getId() / 20.0) + 1
                   ]]>
                </ValueExpr>
            </Slot>
        </PhysicalObjects>
    </InitialState>
    <UserInterface supportedLanguages="en">
        <AnimationUI>
            <Views>
                <SpaceView>
                    <TwoDimensionalGridSpaceView2D backgroundColor="black">
                        <GridCellPropertyVisualizationMap a0="1" cellViewProperty="fill"
                            mapType="equalityCaseWise" property="cellRole" v0="blue" />
                    </TwoDimensionalGridSpaceView2D>
                </SpaceView>
                <PhysicalObjectView physicalObjectIdRef="1">
                    <PhysicalShape2D>
                        <Square>
                            <ShapePropertyVisualizationMap a0="true" a1="false"
                                mapType="equalityCaseWise" property="mouthOpen"
                                shapeProperty="texture" v0="PacMan_open.png" v1="PacMan_close.png" />
                            <ShapePropertyVisualizationMap a0="SOUTH" a1="WEST" a2="NORTH" a3="EAST"
                                mapType="enumerationMap" property="movingDirection"
                                shapeProperty="horizontalFlip" v0="true" v1="true" v2="false"
                                v3="false" />
                            <ShapePropertyVisualizationMap a0="EAST" a1="NORTH" a2="WEST" a3="SOUTH"
                                mapType="enumerationMap" property="movingDirection"
                                shapeProperty="rot" v0="0" v1="90" v2="0" v3="90" />
                        </Square>
                    </PhysicalShape2D>
                </PhysicalObjectView>
                <PhysicalObjectView physicalObjectType="GhostBlinky">
                    <PhysicalShape2D>
                        <Square>
                            <ShapePropertyVisualizationMap a0="EAST" a1="NORTH" a2="WEST" a3="SOUTH"
                                mapType="enumerationMap" property="movingDirection"
                                shapeProperty="texture" v0="red_ghost_look_east.png"
                                v1="red_ghost_look_north.png" v2="red_ghost_look_west.png"
                                v3="red_ghost_look_south.png" v4="red_ghost_look_none.png" />
                        </Square>
                    </PhysicalShape2D>
                </PhysicalObjectView>
                <PhysicalObjectView physicalObjectType="GhostInky">
                    <PhysicalShape2D>
                        <Square>
                            <ShapePropertyVisualizationMap a0="EAST" a1="NORTH" a2="WEST" a3="SOUTH"
                                mapType="enumerationMap" property="movingDirection"
                                shapeProperty="texture" v0="turquoise_ghost_look_east.png"
                                v1="turquoise_ghost_look_north.png" v2="turquoise_ghost_look_west.png"
                                v3="turquoise_ghost_look_south.png" v4="turquoise_ghost_look_none.png" />
                        </Square>
                    </PhysicalShape2D>
                </PhysicalObjectView>
                <PhysicalObjectView physicalObjectType="PillFood">
                    <PhysicalShape2D>
                        <Circle texture="PillFood.png" />
                    </PhysicalShape2D>
                </PhysicalObjectView>
            </Views>
            <AgentControlUI>
                <AgentControlByAgentType htmlTemplate="three_columns"
                    suspendRules="MoveEast_Rule MoveWest_Rule MoveNorth_Rule MoveSouth_Rule"
                    type="PacMan">
                    <EventList />
                    <OutputField label="Remaining food">
                        <Label>
                            <Text>Available food</Text>
                        </Label>
                        <Hint>
                            <Text>The number of available food pieces on the map.</Text>
                        </Hint>
                        <Format decimalPlaces="0">
                            <PackagingUnits>bags</PackagingUnits>
                        </Format>
                        <Source>
                            <GlobalVariable name="remainingPillFoodNumber" />
                        </Source>
                    </OutputField>
                    <UserActionEventListener actionRule="MoveEast_ActionRule">
                        <WHEN>
                            <KeyboardEvent keyIdentifier="Right" />
                            <KeyboardEvent keyIdentifier="D" />
                        </WHEN>
                    </UserActionEventListener>
                    <UserActionEventListener actionRule="MoveWest_ActionRule">
                        <WHEN>
                            <KeyboardEvent keyIdentifier="Left" />
                            <KeyboardEvent keyIdentifier="A" />
                        </WHEN>
                    </UserActionEventListener>
                    <UserActionEventListener actionRule="MoveNorth_ActionRule">
                        <WHEN>
                            <KeyboardEvent keyIdentifier="Up" />
                            <KeyboardEvent keyIdentifier="W" />
                        </WHEN>
                    </UserActionEventListener>
                    <UserActionEventListener actionRule="MoveSouth_ActionRule">
                        <WHEN>
                            <KeyboardEvent keyIdentifier="Down" />
                            <KeyboardEvent keyIdentifier="S" />
                        </WHEN>
                    </UserActionEventListener>
                </AgentControlByAgentType>
            </AgentControlUI>
        </AnimationUI>
    </UserInterface>
</SimulationScenario>
